# 三维视觉新范式阅读笔记

## NERF入门

### NERF简介

1. 什么是NERF
   
    **NeRF**（Neural Radiance Field，神经辐射场）是一种基于神经网络的**连续三维隐式表达方法**，用于高质量新视角合成（NVS）。其核心是通过神经网络建模场景中每个点的辐射信息（颜色、密度），形成连续的**五维函数**（空间坐标+视角方向）。输入多视角图像后，NeRF自动学习几何与纹理，并通过**体渲染**生成逼真新视图。自2020年提出以来，因其高真实感渲染能力，迅速成为三维重建、VR/AR等领域的重要技术。渲染效果接近真实照片，支持动态交互体验。

2. 三维表达方式

    | 表达方式   | 类型     | 存储形式      | 优点                                                                 | 缺点                                                                 |
    |------------|----------|--------------------|----------------------------------------------------------------------|----------------------------------------------------------------------|
    | **点云**   | 显式     | 无序点集合         | - 采集简单直接<br>- 适合传感器原始数据                               | - 无表面拓扑<br>- 渲染困难              |
    | **网格**   | 显式     | 顶点+边+面    | - 渲染高效<br>- 支持细节编辑<br>- 工业标准格式                       | - 建模复杂耗时<br>- 非均匀细节易失真<br>- 存储量随细节增加而显著增长 |
    | **体素**   | 显式     | 规则3D数组        | - 结构规整<br>- 兼容CNN处理<br>- 适合医学影像等均匀数据              | - 内存消耗立方增长<br>- 分辨率受限                                   |
    | **占据网络** | 隐式   | 神经网络预测         | - 内存高效<br>- 可微分优化<br>- 自适应复杂几何                      | - 训练成本高<br>- 实时推理慢                                        |
    | **NeRF**   | 隐式     | 5D辐射场函数         | - 超逼真渲染<br>- 自监督学习<br>- 支持复杂光照                      | - 计算开销大<br>- 动态场景支持有限<br>- 需要大量视角输入           |


3. 国内外主要实验室
   
   | 机构名称 | 代表人物 | 主要贡献/成果 |
    |---------|----------|--------------|
    | **谷歌研究团队** | Ben Mildenhall, Pratul P. Srinivasan等 | Mip-NeRF, Mip-NeRF 360, Zip-NeRF |
    | **慕尼黑工业大学** | Matthias Nießner教授 | DiffRF, HumanRF |
    | **多伦多大学** | Sanja Fidler教授 | FEGR, NKSR |
    | **Luma AI** | Alex Yu博士 | PlenOctrees, Plenoxels, pixelNeRF |
    | **马克斯普朗克研究所** | Christian Theobalt教授 | F2-NeRF, NeuS, NeuS2 |
    | **图宾根大学AVG实验室** | Andreas Geiger教授 | Occupancy Network, KiloNeRF |
    | **ETH Zurich** | Marc Pollefeys教授等 | NICE-SLAM, MonoSDF |
    | **UCSD** | 苏昊教授 | TensoRF, MVSNeRF |
    | **新加坡国立大学** | Gim Hee Lee教授 | OD-NeRF, DBARF |
    | **南洋理工大学** | 刘子纬教授 | CityDreamer, F2-NeRF |
    | **康奈尔大学** | Noah Snavely教授 | DynIBaR |
    | **宾夕法尼亚大学** | 刘玲洁教授 | NeuS, NeuS2 |
    | **马里兰大学** | 黄嘉斌教授 | RoDynRF, ClimateNeRF |
    | **浙江大学** | 杨易教授,周晓巍教授等 | READ, Dyn-E, TensoIR |
    | **清华大学** | 朱军教授,赵吴教授等 | ProlificDreamer, MARS |
    | **中科院计算所** | 高林教授 | NeRF-Editing, Tri-MipRF |
    | **上海科技大学** | 虞晶怡教授 | TensoRF, MVSNeRF |

### NERF基础

1. 三维空间基础
   
    坐标系、点、向量；

    刚体运动欧式变换（旋转+平移）；

    变换矩阵与齐次坐标；

    刚体旋转表达方式（旋转矩阵、欧拉角、四元数）。

        欧拉角按Z-X-Y顺序旋转，Z旋转得到偏航角yaw，X旋转得到俯仰角pitch，Y旋转得到滚转角roll。
        四元数表示旋转。在二维空间中，复数可以表示旋转，复数扩展到四元数，可以实现三维空间的旋转。

    | **表示方法** | **数学表示**                          | **优点**                          | **缺点**                                  |
    |--------------|---------------------------------------|-----------------------------------|-------------------------------------------|
    | **旋转矩阵** | 3×3正交矩阵 <br> $R^T R = I$          | 可直接用于坐标变换 | - 9个参数冗<br>- 插值困难            | 
    | **欧拉角**   | 3个轴向旋转角 <br> (roll, pitch, yaw) | - 直观易理解<br>- 仅需3个参数     | - 万向节锁问题<br>- 旋转顺序影响结果       | 
    | **四元数**   | 4元数 $q = w + xi + yj + zk$          | - 插值平滑<br>- 计算高效 | - 数学抽象（有点难理解）            | 


2. 三维视觉与图形学基础

    相机模型
        
        相机模型成像过程：
        世界坐标系->相机坐标系->图像坐标系->像素坐标系
        在坐标系转换过程中，第一个矩阵的所有参数仅与相机本身有关，称为相机内参；第二个矩阵的参数仅与相机拍摄的位姿有关，称为相机外参。两者统称为相机参数，对NeRF的重建过程至关重要。

    辐射测量基础

    | 物理量         | 符号   | 公式                                                                 | 单位         | 说明                                                                 |
    |----------------|--------|----------------------------------------------------------------------|--------------|----------------------------------------------------------------------|
    | **辐射能量**   | Q      | $Q = \int_{t_1}^{t_2} \Phi_e dt$                                    | 焦耳 (J)     | 电磁辐射在时间间隔内传递的总能量                                     |
    | **辐射通量**   | Φₑ     | $\Phi_e = \frac{dQ}{dt}$                                            | 瓦特 (W)     | 单位时间内通过某面积的辐射能量（功率）                               |
    | **辐射强度**   | Iₑ     | $I_e = \frac{d\Phi_e}{d\Omega}$                                     | W/sr         | 点光源在单位立体角内发出的辐射通量                                   |
    | **辐射照度**   | Eₑ     | $E_e = \frac{d\Phi_e}{dA}$                                          | W/m²         | 单位接收面积上入射的辐射通量                                         |
    | **辐射亮度**   | Lₑ     | $L_e = \frac{d^2\Phi_e}{dA \cosθ d\Omega}$                          | W/(m²·sr)    | 单位投影面积和单位立体角内的辐射通量                                 |


    光源

        点光源、平行光源、环境光源

    材质建模与着色

        双向反射分布函数（对称性、能量守恒）；Lambertian反射模型（一种理想化的漫反射材质模型）；Phong模型；Blinn-Phong模型（广泛应用 OpenGL）

    光线追踪

        正向光线追踪；反向光线追踪（计算量小）

3. 深度学习基础
   
    跳过

4. 质量评价基础

    二维平面空间质量评价

        峰值信噪比PSNR（基于两张图片的均方误差计算得）；
        结构相似性指数SSIM（基于亮度、对比度、结构三个因素综合评分，通过像素平均值、方差、协方差计算得）；
        可学习感知图像块相似度LPIPS（基于神经网络特征提取进行评价）


    三维立体空间质量评价

        倒角距离（基于距离平方和评估差异）


### NERF技术细节

1. NeRF解决的问题
   
        利用有限数量的二维图像来合成三维场景,并保证生成的新视角图像  的真实感。需要处理不同的光照条件、材质状态、复杂的物体遮挡问题及噪声。


2. NeRF原理
    
    参考https://www.bilibili.com/video/BV1CC411V7oq/?spm_id_from=333.337.search-card.all.click&vd_source=28e009d51d54ec792b46f3d73f094aa0
   
        广义理解定义：
        - 使用神经网络隐式的存储3D信息（显示有明确的xyz值，隐式无明确xyz值，只能输出指定角度的2D图片）
        - 训练时使用给定静止场景下的若干张图片。

        推论：
        - 模型不具有泛化能力
        - 一个模型智能存储一个3D信息

        论文：
        - 模型输入是5D向量（x\y\z\theta\phi）
        - 模型输出是4D向量（密度、颜色）
        - 模型是8层MLP
  
        ！！！NERF的重点是前后处理

        前处理：
        - 将图片中的每个像素，通过相机模型找到对应射线
        - 在每条射线上进行采样，得到64个粒子
        - 对粒子进行位置编码（类似transformer）
        - 坐标位置63D，方向向量27D
        
        模型1：
        - 8层MLP
        - 输入为batch_size * 64 * 63和batch_size * 64 * 27
        - 输出为batch_size * 64 * 4

        后处理：
        - 计算模型1的输出，对射线进行二次采样，采集更有代表性的信息
        - 每条射线上共采样192个粒子。

        模型2：
        - 8层MLP
        - 输入为batch_size * 192 * 63和batch_size * 192 * 27
        - 输出为batch_size * 192 * 4

        后处理2：
        - 将模型2的输出通过体渲染，转化为像素



3. NeRF开源项目
   
    跳过

4. NeRF常用的数据集

    | 类别                          | 数据集名称                                                                 |
    |-------------------------------|--------------------------------------------------------------------------|
    | 二维图像数据集                | Realistic Synthetic 360数据集、LLFF数据集、Mip-NeRF360数据集、RealEstate10K数据集、DeepBlending数据集、DTU MVS数据集、ScanNet数据集、Tank and Temples数据集、MVImgNet数据集 |
    | 面向大规模场景和自动驾驶的数据集 | KITTI数据集、KITTI 360数据集                                             |
    | 三维模型数据集                | ShapeNet数据集、Objaverse数据集、OmniObject3D数据集                      |
    | 常用动态数据集                | D-NeRF数据集、DyNeRF数据集                                               |
    | 面向大规模场景的数据集        | Replica数据集、ACID数据集                                                |
    | 面向人体建模的数据集          | ZJU-MoCap数据集、Neuman数据集、NeRSemble数据集、ActorsHQ数据集、DNA-Rendering数据集 |
    | 其他类型数据集                | CarPatch3D数据集、SPIn-NeRF数据集                                        |